{"version":3,"sources":["../src/react/components/connect/index.tsx","../src/react/components/connect/context.tsx","../src/react/hooks/use-connect.ts"],"names":["initialState","connectReducer","state","type","payload","__spreadProps","__spreadValues","ConnectContext","createContext","ConnectDispatchContext","ConnectProvider","authOptions","children","dispatch","useReducer","React","Connect","useConnectDispatch","useContext","useConnect","isOpen","isAuthenticating","authData","userSession","doUpdateAuthOptions","doOpenAuth","signIn","options","provider","_options","_a","authenticate","showBlockstackConnect","doAuth","doContractCall","openContractCall","doContractDeploy","openContractDeploy","doSTXTransfer","openSTXTransfer","doProfileUpdate","openProfileUpdateRequestPopup","doSignTransaction","openSignTransaction","sign","openSignatureRequestPopup","signStructuredData","openStructuredDataSignatureRequestPopup","signPsbt","openPsbtRequestPopup"],"mappings":"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","file":"index.mjs","sourcesContent":["import React from 'react';\nimport { ConnectProvider } from './context';\nimport { AuthOptions } from '@stacks/connect';\n\n/**\n * Usage\n *\n *\n * const auth = {\n      manifestPath: '/static/manifest.json',\n      redirectTo: '/',\n      finished: ({userSession}) => {\n        doFinishSignIn();\n      },\n      authOrigin,\n      appDetails: {\n        name: 'Wink',\n        icon: 'url'\n      }\n    }\n *\n * <Connect authOptions={authOptions} />\n */\nconst Connect = ({ authOptions, children }: { authOptions: AuthOptions; children: any }) => {\n  return <ConnectProvider authOptions={authOptions}>{children}</ConnectProvider>;\n};\n\nexport { Connect };\n","import React, { useReducer, createContext } from 'react';\nimport { AuthOptions, FinishedAuthData, UserSession } from '@stacks/connect';\n\nenum States {\n  UPDATE_AUTH_OPTIONS = 'data/update-auth-options',\n}\n\ntype Action = { type: States; payload?: any };\n\ntype Dispatch = (action: Action) => void;\n\ntype State = {\n  isOpen: boolean;\n  isAuthenticating: boolean;\n  authData?: FinishedAuthData;\n  authOptions: AuthOptions;\n  userSession?: UserSession;\n};\n\nconst initialState: State = {\n  isOpen: false,\n  isAuthenticating: false,\n  authData: undefined,\n  userSession: undefined,\n  authOptions: {\n    redirectTo: '',\n    manifestPath: '',\n    onFinish: () => null,\n    authOrigin: undefined,\n    sendToSignIn: false,\n    appDetails: {\n      name: '',\n      icon: '',\n    },\n  },\n};\n\nconst connectReducer = (state: State, { type, payload }: { type: States; payload?: any }) => {\n  switch (type) {\n    case States.UPDATE_AUTH_OPTIONS: {\n      return {\n        ...state,\n        authOptions: {\n          ...state.authOptions,\n          ...payload,\n        },\n      };\n    }\n\n    default: {\n      throw new Error(`Unhandled action type: ${type}`);\n    }\n  }\n};\n\nconst ConnectContext = createContext<State>(initialState);\n\nconst ConnectDispatchContext = createContext<Dispatch | undefined>(undefined);\n\nconst ConnectProvider = ({\n  authOptions,\n  children,\n}: {\n  authOptions: AuthOptions;\n  children: any;\n}) => {\n  const [state, dispatch] = useReducer(connectReducer, initialState);\n\n  return (\n    <ConnectContext.Provider value={{ ...state, authOptions }}>\n      <ConnectDispatchContext.Provider value={dispatch}>{children}</ConnectDispatchContext.Provider>\n    </ConnectContext.Provider>\n  );\n};\n\nexport {\n  initialState,\n  connectReducer,\n  ConnectContext,\n  ConnectDispatchContext,\n  ConnectProvider,\n  States,\n};\n","import {\n  authenticate,\n  AuthOptions,\n  ContractCallOptions,\n  ContractCallRegularOptions,\n  ContractCallSponsoredOptions,\n  ContractDeployOptions,\n  ContractDeployRegularOptions,\n  ContractDeploySponsoredOptions,\n  FinishedAuthData,\n  openContractCall,\n  openContractDeploy,\n  openProfileUpdateRequestPopup,\n  openPsbtRequestPopup,\n  openSignatureRequestPopup,\n  openSignTransaction,\n  openStructuredDataSignatureRequestPopup,\n  openSTXTransfer,\n  ProfileUpdateRequestOptions,\n  PsbtRequestOptions,\n  showBlockstackConnect,\n  SignatureRequestOptions,\n  SignTransactionOptions,\n  StacksProvider,\n  StructuredDataSignatureRequestOptions,\n  STXTransferOptions,\n  STXTransferRegularOptions,\n  STXTransferSponsoredOptions,\n} from '@stacks/connect';\nimport { useContext } from 'react';\nimport { ConnectContext, ConnectDispatchContext, States } from '../components/connect/context';\n\nconst useConnectDispatch = () => {\n  const dispatch = useContext(ConnectDispatchContext);\n  if (!dispatch) {\n    throw new Error('This must be used within the ConnectProvider component.');\n  }\n  return dispatch;\n};\n\nexport const useConnect = () => {\n  // todo: add custom provider injection in connect context\n  const { isOpen, isAuthenticating, authData, authOptions, userSession } =\n    useContext(ConnectContext);\n\n  const dispatch = useConnectDispatch();\n\n  const doUpdateAuthOptions = (payload: Partial<AuthOptions>) => {\n    return dispatch({ type: States.UPDATE_AUTH_OPTIONS, payload });\n  };\n\n  /**\n   *\n   * @param signIn Whether the user should be sent to sign in\n   * @param options\n   */\n  const doOpenAuth = (\n    signIn?: boolean,\n    options?: Partial<AuthOptions>,\n    provider?: StacksProvider\n  ) => {\n    if (signIn) {\n      const _options: AuthOptions = {\n        ...authOptions,\n        ...options,\n        onFinish: (payload: FinishedAuthData) => {\n          authOptions.onFinish?.(payload);\n        },\n        sendToSignIn: true,\n      };\n      void authenticate(_options, provider);\n      return;\n    } else {\n      void showBlockstackConnect({\n        ...authOptions,\n        sendToSignIn: false,\n      });\n    }\n\n    if (authOptions) doUpdateAuthOptions(authOptions);\n  };\n\n  const doAuth = (options: Partial<AuthOptions> = {}, provider?: StacksProvider) => {\n    void authenticate(\n      {\n        ...authOptions,\n        ...options,\n        onFinish: (payload: FinishedAuthData) => {\n          authOptions.onFinish?.(payload);\n        },\n      },\n      provider\n    );\n  };\n\n  function doContractCall(\n    options: ContractCallOptions | ContractCallRegularOptions | ContractCallSponsoredOptions,\n    provider?: StacksProvider\n  ) {\n    return openContractCall(\n      {\n        ...options,\n        authOrigin: authOptions.authOrigin,\n        appDetails: authOptions.appDetails,\n      },\n      provider\n    );\n  }\n\n  function doContractDeploy(\n    options: ContractDeployOptions | ContractDeployRegularOptions | ContractDeploySponsoredOptions,\n    provider?: StacksProvider\n  ) {\n    return openContractDeploy(\n      {\n        ...options,\n        authOrigin: authOptions.authOrigin,\n        appDetails: authOptions.appDetails,\n      },\n      provider\n    );\n  }\n\n  function doSTXTransfer(\n    options: STXTransferOptions | STXTransferRegularOptions | STXTransferSponsoredOptions,\n    provider?: StacksProvider\n  ) {\n    return openSTXTransfer(\n      {\n        ...options,\n        authOrigin: authOptions.authOrigin,\n        appDetails: authOptions.appDetails,\n      },\n      provider\n    );\n  }\n\n  function doProfileUpdate(options: ProfileUpdateRequestOptions, provider?: StacksProvider) {\n    return openProfileUpdateRequestPopup(\n      {\n        ...options,\n        authOrigin: authOptions.authOrigin,\n        appDetails: authOptions.appDetails,\n      },\n      provider\n    );\n  }\n\n  function doSignTransaction(options: SignTransactionOptions, provider?: StacksProvider) {\n    return openSignTransaction(\n      {\n        ...options,\n        authOrigin: authOptions.authOrigin,\n        appDetails: authOptions.appDetails,\n      },\n      provider\n    );\n  }\n\n  function sign(options: SignatureRequestOptions, provider?: StacksProvider) {\n    return openSignatureRequestPopup(\n      {\n        ...options,\n        authOrigin: authOptions.authOrigin,\n        appDetails: authOptions.appDetails,\n      },\n      provider\n    );\n  }\n\n  function signStructuredData(\n    options: StructuredDataSignatureRequestOptions,\n    provider?: StacksProvider\n  ) {\n    return openStructuredDataSignatureRequestPopup(\n      {\n        ...options,\n        authOrigin: authOptions.authOrigin,\n        appDetails: authOptions.appDetails,\n      },\n      provider\n    );\n  }\n\n  function signPsbt(options: PsbtRequestOptions, provider?: StacksProvider) {\n    return openPsbtRequestPopup(\n      {\n        ...options,\n        authOrigin: authOptions.authOrigin,\n        appDetails: authOptions.appDetails,\n      },\n      provider\n    );\n  }\n\n  return {\n    isOpen,\n    isAuthenticating,\n    authData,\n    authOptions,\n    userSession,\n    doOpenAuth,\n    doAuth,\n    authenticate,\n    doContractCall,\n    doContractDeploy,\n    doSTXTransfer,\n    doSignTransaction,\n    doProfileUpdate,\n    sign,\n    signStructuredData,\n    signPsbt,\n  };\n};\n"]}